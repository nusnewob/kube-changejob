# Configure the controller manager deployment
manager:
  # Controller config
  config:
    # pollInterval: 60s # Controller polling interval
    # debug: false
    # logging:
    #   level: info # debug, info, warn, error, panic, fatal or any integer value > 0 which corresponds to custom debug levels of increasing verbosity
    #   format: text # json or text
    #   timestamp: rfc3339 # epoch, millis, nano, iso8601, rfc3339 or rfc3339nano

  replicas: 2

  image:
    repository: ghcr.io/nusnewob/kube-changejob
    # tag: latest
    pullPolicy: IfNotPresent

  # Arguments
  args: []

  # Environment variables
  env: []

  # Controller watched resources types, also configures controller RBAC permissions
  # Default allows to watch all resources
  watchResources:
    - apiGroups: ["*"]
      resources: ["*"]

  # Pod-level security settings
  podSecurityContext:
    runAsNonRoot: true
    seccompProfile:
      type: RuntimeDefault

  # Container-level security settings
  securityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop:
        - ALL
    readOnlyRootFilesystem: true

  # Resource limits and requests
  resources:
    limits:
      cpu: 500m
      memory: 128Mi
    requests:
      cpu: 10m
      memory: 64Mi

webhook:
  port: 9443

# Essential RBAC permissions (required for controller operation)
# These include ServiceAccount, controller permissions, leader election, and metrics access
# Note: Essential RBAC is always enabled as it's required for the controller to function

# Helper RBAC roles for managing custom resources
# These provide convenient admin/editor/viewer roles for each CRD type
# Useful for giving users different levels of access to your custom resources
rbacHelpers:
  enable: true # Install convenience admin/editor/viewer roles for CRDs

# Custom Resource Definitions
crd:
  enable: true # Install CRDs with the chart
  keep: true # Keep CRDs when uninstalling

# Controller metrics endpoint.
# Enable to expose /metrics endpoint with RBAC protection.
metrics:
  enable: true
  port: 8443 # Metrics server port

# Cert-manager integration for TLS certificates.
# Required for webhook certificates and metrics endpoint certificates.
certManager:
  enable: true

# Prometheus ServiceMonitor for metrics scraping.
# Requires prometheus-operator to be installed in the cluster.
prometheus:
  enable: false
